---
title: "Introduction to R, Week 2: Working with data"
output: github_document
---

<!--week2.md is generated from week2.Rmd. Please edit that file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Objectives

In the last section, 
we learned some fundamental principles of R and how to work in RStudio.

In this session,
we'll continue our introduction to R by working with a large dataset 
that more closely resembles that which you may encounter while analyzing data for research. 
By the end of this session, you should be able to:

- import spreadsheet-style data into R as a data frame
- extract portions of data from a data frame
- manipulate factors (categorical data)

## Importing spreadsheet-style data into R

Open RStudio, and we'll check to make sure you're ready to start work again.
You can check to see if you're working in your project directory 
by looking at the top of the Console. 
You should see the path (location in your computer)
for the project directory you created last time 
(e.g., `~/Desktop/intro_r`).

If you do not see the path to your project directory,
go to `File -> Open Project` and navigate to the location of your project directory.
Alternatively, using your operating system's file browser,
double click on the `r_intro.Rrpoj` file.

In the last session, we recommended organizing your work in 
directories (folders) according to projects.
While a thorough discussion of project organization is beyond the scope of this class,
we will continue to model best practices by creating a directory to hold our data:

```{r eval=FALSE}
# make a directory
dir.create("data")
```

```{r include=FALSE}
# code above not run, so this hidden code creates the directory if necessary
if (!dir.exists("data")) {dir.create("data")}
```

You should see the new directory appear in your project directory, 
in the lower right panel in RStudio. 
There is also a button in that panel you can use to create a new folder,
but including the code to perform this task makes other people 
(and yourself) able to reproduce your work more easily.

Now that we have a place to store our data,
we can go ahead and download the dataset:

```{r}
# download data from url
download.file("https://raw.githubusercontent.com/fredhutchio/R_intro/master/extra/clinical.csv", "data/clinical.csv")
```

The code above has two arguments, 
both encompassed in quotation marks:
first, you indicate where the data can be found online. 
Second, you indicate where R should store a copy of the file on your own computer.

The output from that command may look alarming,
but it represents information confirming it worked.
You can click on the `data` folder to ensure the file is now present.

Notice that the URL above ends in `clinical.csv`,
which is also the name we used to save the file on our computers.
If you click on the URL and view it in a web browser, 
the format isn't particularly easy for us to understand.
You can also view the file by clicking on it in the lower right hand panel,
then selecting "View File."

> The option to "Import Dataset" you see after clicking on the file 
> references some additional tools present in RStudio 
> that can assist with various kinds of data import.
> Because this requires installing additional software, 
> complete exploration of these options is outside the scop of this class.
> For more information, check out [this article](https://support.rstudio.com/hc/en-us/articles/218611977-Importing-Data-with-RStudio).

The data we've downloaded are in csv format, 
which stands for "comma separated values."
This means the data are organized into rows and columns,
with columns separated by commas.

These data are arranged in a tidy format,
meaning each row represents an observation, 
and each column represents a variable (piece of data for each observation).
Moreover, only one piece of data is entered in each cell. 

Now that the data are downloaded, 
we can import the data and assign to an object:

```{r}
# import data and assign to object
clinical <- read.csv("data/clinical.csv")
```

You should see `clinical` appear in the Environment window on the upper right panel in RStudio.
If you click on `clinical` there,
a new tab will appear next to your R script in the Source window.

> Clicking on the name of an object in the Environment window 
> is a shortcut for running `View(clinical)`;
> you'll see this code appear in the Console after clicking.

About these data:

- describe where data came from and give brief overview of metadata: TCGA clinical data from different cancer types
- show script used to produce data
- note data in tab can't be edited!
- note missing data

Check out the help documentation for `read.csv` for more information on importing data in formats other than csv.

read.csv is one of a family of commands to import data

**Challenge:** Download, inspect, and import the following data files.


- example1: https://raw.githubusercontent.com/fredhutchio/R_intro/master/extra/clinical.tsv
- example2: https://raw.githubusercontent.com/fredhutchio/R_intro/master/extra/clinical.txt

can also read into R straight from URL using read.csv, but better practice to download data file for reference

## Data frames 

data frames: tabular/spreadsheet data
table where columns are vectors all of same length
columns contain single type of data (characters, integers, factors)

inspect data frames

```{r}
# assess size of data frame
dim(clinical)
# preview content
head(clinical) # show first few rows
tail(clinical) # show last few rows
```


```{r}
# view names
names(clinical) # column names
```

It's also possible to view row names using`rownames(clinical)`,
but our data only possess numbers for row names so it's not very informative.

```{r}
str(clinical) # structure of object
```


```{r}
summary(clinical) # summary statistics by column
```


**Challenge**: What is the class, how many rows/columns, how many types of cancer (disease)?

## Subsetting data frames


```{r}
# extract first column
clinical[1]
```

rows, columns

```{r eval=FALSE, include=FALSE}
# extract first column
clinical[ , 1]
```


**Challenge:** what is the difference in results between the last two lines of code?

```{r}

```



# extract first row, first column
clinical[1,1]
# extract single row 
clinical[1, ]
# extract a range of cells
clinical[1:3, 2] # rows 1 to 3, second column
# exclude certain data subsets
clinical[ , -1] # exclude first column
clinical[-c(1:100), ] # exclude first 100 rows
# save extracted data to new object
test_clinical <- clinical[1:20, ]

# extract columns by name
clinical["tumor_stage"] # result is data.frame
clinical[ , "tumor_stage"] # results in vector
clinical[["tumor_stage"]] # results in vector
clinical$tumor_stage # results in vector
# reference exploring different types of subsetting: https://davetang.org/muse/2013/08/16/double-square-brackets-in-r/

#### BREAK ####

## Challenge: code as many different ways possible to extract the column days_to_death

## Challenge: extract the first 6 rows for only age at diagnosis and days to death

## Challenge: calculate the range and mean for cigarettes per day

#### Factors ####

# factors represent categorical data
# predefined sets of values (levels), in alphabetical order
# stored as integers with labels
# can be ordered or unordered

# create factor
test_data <- factor(c("placebo", "test_drug", "placebo", "known_drug"))
levels(test_data) # show levels
nlevels(test_data) # count levels
# show current
test_data
# reorder (may be necessary if order matters)
test_data <- factor(test_data, levels = c("known_drug", "test_drug", "placebo"))
# show reordered
test_data

# converting factors
as.numeric(test_data)
# factors can also appear as numbers! not advisable, but useful to know if accidental

# renaming factors
plot(clinical$race) # plot data (may need to resize the window)
race <- clinical$race # save data to object
levels(race) # show levels of factor
# rename factor
levels(race)[2] <- "Zsian"
race # show revised data
# replace race in data frame
clinical$race <- race
# replot with corrected names
plot(clinical$race)

# for more information, see link on working with categorical data in HackMD

## Challenge: replace "not reported" in ethnicity and race with NA
# do a Google search to find additional strategies for renaming missing data
# when regrouping after challenge, include a demo of looking at search results
#   blog posts (e.g., RStats) may give good tutorials of common tasks
#   Stack Overflow is great, upvotes and simple solutions are great to start

#### Extra: creating a simple data frame without importing data ####

# create individual vectors
cancer <- c("lung", "prostate", "breast")
metastasis <- c("yes", "no", "yes")
cases <- c(30, 50, 100)
# combine vectors
example_df1 <- data.frame(cancer, metastasis, cases)
str(example_df1)

# create vectors and combine at once
example_df2 <- data.frame(cancer = c("lung", "prostate", "breast"),
                          metastasis = c("yes", "no", "yes"),
                          cases = c(30, 50, 100), stringsAsFactors = FALSE) # determines whether character or factor
str(example_df2)

#### Wrapping up ####

# review objectives
# direct towards practice questions (linked in HackMD)
# preview next week's objectives
# install tools for next week: install.packages("tidyverse")
