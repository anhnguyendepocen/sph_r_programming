---
title: "Introduction to R, Part 2: Data Frames, Reading Data, visualizing data with ggplot2"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Welcome to Ready for R: Part 2!

In this session, we'll continue our introduction to R by working with a large dataset that more closely resembles that which you may encounter while analyzing data for research.



## Learning Objectives

By the end of this session, you should be able to:

1. **Import** spreadsheet-style data into R as a `data.frame`
2. **Understand** properties of `data.frames`, especially variables.
3. **Visualize** `numeric` vectors in this dataset using `ggplot2`


## A note about Base R versus the Tidyverse

For the remainder of this course, we'll be focusing on using functions from the [tidyverse](https://www.tidyverse.org/). 

The Tidyverse is essentially a library of libraries -- each contains functions that are either essential for or *greatly* simplify the process of data manipulation and visualization for data scientists. You can install this library (and all of its dependencies) using `install.packages('tidyverse')`. Once you've installed `tidyverse`, let's load it up!

```{r warning=F}
library(tidyverse)
```



## Importing spreadsheet-style data into R

Once you have your notebook open, let's check to see which directory R Studio is working from using `getwd()`.

```{r}
getwd()
```

Take a look at the `data/` folder, and at the 

```{r}
brca_clinical <- read_excel("data/tcga_clinical_data.xlsx",
                            sheet = 1, 
                            skip = 1)
```

You can see the excel file here: 

You should see `brca_clinical` appear in the Environment window on the upper right panel in RStudio. If you click on `brca_clinical` there, a new tab will appear next to your R script in the Source window.


> Clicking on the name of an object in the Environment window 
> is a shortcut for running `View(brca_clinical)`;
> you'll see this code appear in the Console after clicking.

## Quick Questions

Take a look at the documentation for read_excel. 

1. What does the `skip` argument do? 
2. Do we need to refer to a `sheet` within an excel file as a number, or can we refer to it as the sheet name instead? 

```{r}
?read_excel
```

[Your answers here]


Now that we have the data imported and assigned to an object, we can take some time to explore the data we'll be using for the rest of this course:


- These data are clinical cancer data from the [National Cancer Institute's Genomic Data Commons](https://gdc.cancer.gov), specifically from The Cancer Genome Atlas, or [TCGA](https://www.cancer.gov/about-nci/organization/ccg/research/structural-genomics/tcga).
- Each row represents a patient, and each column represents information about demographics (race, age at diagnosis, etc) and disease (e.g., cancer type).
- The data were downloaded and aggregated using an R script, which you can view in the [GitHub repository for this course](https://github.com/fredhutchio/R_intro/blob/master/0dataset.R).


The function we use to import the data is from a `tidyverse` package called `readr`. If you have an Excel file, you can use a similar package (also included in `tidyverse`), `readxl,` and it's command `read_excel`.

## Challenge 1:

Inspect, and import the following sheets from the excel file.

1. The `CESC` sheet. Save it as `cesc_clinical`.
2. The `LUSC` sheet. Save it as `lusc_clinical`.

```{r}
#load cesc_clinical here
#What should be the sheet argument?
#do you need to skip a line?
cesc_clinical <- read_excel("data/tcga_clinical_data.xlsx",
                            sheet = ____, 
                            skip = ___)  

#load lusc_clinical here
lusc_clinical <- 
```

Importing data can be tricky and frustrating. However, if you can't get your data into R, you can't do anything to analyze or visualize it. It's worth understanding how to do it effectively to save you time and energy later.

We will be covering loading in another format that you can export from many different software programs, the *comma separated value* format, or `csv` format in another section.



## Tips on Formating your excel file for R


1. Try to format your spreadsheet where the columns correspond to variables you're measuring, and a row corresponds to an observation.

In our example, each row corresponds to a patient, and each column corresponds to a piece of clinical data.


2. If your data isn't in this format, no worries! You can copy it to a new sheet and use the transpose option when you're pasting it, and then load that in.


3. Every one of your columns should be named at the top. 


4. Avoid using color coding of cells if that is extra information attached to a cell. Instead, make the information the color is representing its own column. 


5. Extra lines before the column header are ok, as you've seen. It's sometimes better to have a "notes" sheet where you put extra information.




## `data.frame`s

Now that we have data imported and available, we can start to inspect the data more closely. These data have been interpreted by R to be a data frame, which is a data structure (way of organizing data) that is analogous to tabular or spreadsheet style data. By definition, a data frame is a table made of vectors (columns) of all the same length. As we learned in our last session, a vector needs to include all of the same type of data (e.g., character, numeric). A data frame, however, can include vectors (columns) of different data types.

To learn more about this data frame, we'll first explore its dimensions:

```{r}
# assess size of data frame
dim(brca_clinical)
```

This output reflects the number of rows, then the number of columns.

We can also preview the content by showing the first few rows:

```{r}
# preview first few rows
head(brca_clinical) 
```

**Challenge 2:** The default number of rows shown is six. Can you show the first 15 rows?

```{r}

```

We often need to reference the names of columns, so it's useful to print only those to the screen:

```{r}
# view column names
colnames(brca_clinical) 
```

It's also possible to view row names using`rownames(brca_clinical)`, but our data only possess numbers for row names so it's not very informative.




We can use `glimpse` to provide a general overview of the object:

```{r}
# show overview of data.frame
glimpse(birth) 
```
The output provided includes:

- data structure: data frame
- dimensions: 6832 rows and 20 columns
- column-by-column information: each prefaced with a `$`, and includes the column name, data type (num, int, Factor)

> Factors are how character data are interpreted by R in data frames.
> We'll talk more about working with factors at the end of this lesson.

Finally, we can also examine basic summary statistics for each column:

```{r}
# provide summary statistics for each column
summary(brca_clinical) 

```

For numeric data (such as `year_of_death`), this output includes common statistics like median and mean, as well as the number of rows (patients) with missing data (as `NA`). For factors (character data, such as `disease`), you're given a count of the number of times the top six most frequent factors (categories) occur in the data frame.




## Introducing `ggplot2`

```{r}
knitr::include_graphics("image/ggplot2_exploratory.png")

```


```{r}
birth <- readr::read_csv(here::here("extra/birth_reduced.csv"))

library(tidyverse)

ggplot(data = birth, 
       aes(x=(age_at_diagnosis)/365, 
           y = cigarettes_per_day, 
           color = race)) +
    geom_point() + 
    geom_smooth(method = "lm")
```




## Assignment


1. Load the `smoke_complete.xlsx` file into R using `read_excel`. You'll need to take a look at it to make sure that your arguments are correct.


2. Use `glimpse()` on `smoke_complete`. How many rows does the file have? How many variables does it have? What are the numeric variables in this dataset?


3. Produce a scatter plot of `smoke_complete` using `geom_point()`, mapping these variables to the aesthetics.

`year_of_birth` to the `x` aesthetic, 
`cigarettes_per_day` to the `y` aesthetic, and
`gender` to the `color` aesthetic.


4. Pick two `numeric` variables in the dataset and produce a scatterplot by mapping them to `x`, `y`, and `color`. 